<%@ Page Language="C#" AutoEventWireup="true" CodeFile="account-statement.aspx.cs" Inherits="Modules_Account_Statement_account_statement" %>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="<%=G.B%>assets/images/favicon.ico">
    <title>SUS ERP - Account Statement Print</title>
    <link rel="stylesheet" href="<%=G.B%>assets/vendor_components/bootstrap/dist/css/bootstrap.css">

    <link rel="stylesheet" href="<%=G.B%>assets/css/bootstrap-extend.css">

    <link rel="stylesheet" href="<%=G.B%>assets/vendor_components/select2/dist/css/select2.min.css">
    <link href="<%=G.B%>assets/vendor_components/jquery-toast-plugin-master/src/jquery.toast.css" rel="stylesheet">
    <link rel="stylesheet" href="<%=G.B%>assets/css/master_style.css">
    <link rel="stylesheet" href="<%=G.B%>assets/css/skins/_all-skins.css">
    <link href="<%=G.B%>assets/css/print.css" rel="stylesheet">

    <style>
        .table > tbody > tr > td, .table > tfoot > tr > td {
            padding: 3px 5px !important;
        }

        .table > thead > tr > th {
            padding: 10px 6px !important;
            font-size: 12px !important;
        }

    </style>
</head>
<body class="hold-transition skin-info-light fixed sidebar-mini">
    <form runat="server">
        <input type="hidden" id="HtmlContent" value="" runat="server" />
        <input type="hidden" id="FileNameField" runat="server" />
        <div id="wrap_invoice" class="page A4 portrait delnote-mh">
            <%-- <header class="invoice_header etat_header">
                <div class="row model1">--%>
            <table class="" style="width: 100%">
                <tbody style="color: #383838 !important; font-size: 12px !important; font-family: Calibri, 'Nunito Sans', sans-serif !important; border-top: 1px solid #fff !important">
                    <tr>
                        <td colspan="3" id="Tdcompny">
                           <%-- <b>ISS Global Forwarding UAE LLC
                            </b>--%>
                        </td>
                        <td colspan="4" rowspan="2" style="font-size: 16px !important">
                            <b>ACCOUNT STATEMENT</b>
                    </tr>
                    <tr>
                        <td id="tdCompnyAddress">
                           <%-- <b>Plot - W40-C, Dubai Airport Free Zone (DAFZA)</b>--%>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3" >
                           <%-- <b>P.O Box: 62217<br />
                            Dubai, United Arab Emirates<br />
                            DXB<br />
                            ARE</b>--%>

                        </td>
                        <td colspan="4">
                            <b>Date :</b>
                            <label id="lbldatetime"></label>
                            <br />
                            <b>Phone:</b>
                            <label id="lblphone"></label>
                            <br />
                            <b>Fax:</b>
                            <label id="lblfax"></label>
                            <br />
                            <b>Tax Registration No.:</b>
                            <label id="lblTRNo"></label>


                        </td>
                    </tr>
                    <tr>
                        <td colspan="8" style="padding: 4px"></td>
                    </tr>
                    <tr>
                        <td colspan="3" rowspan="5" id="CusAddress">
                           <%-- <b>AL MOHAIRBI CLEARING & TRANSPORTING LLC
                                <br />
                                TAMOUH TOWER,2409 A,24TH FLOOR<br />
                                MARINE SQUARE<br />
                                ABU DHABI -UAE<br />
                                ARE                                </b>--%></b>
                        </td>
                        <td><b>Customer Account:</b>
                            <label id="lblcustomeraccount"></label>
                        </td>

                    </tr>
                    <tr>
                        <td colspan="4">
                            <b>Terms of Payment:</b>
                            <label id="lbltermsofpayment"> 30 Days</label>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="4">
                            <b>Currency:</b>
                            <label id="lblcurrency">AED</label>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="4">
                            <b>From Date:</b>
                            <label id="lblfromdate"></label>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="4">
                            <b>To Date:</b>
                            <label id="lbltodate"></label>
                        </td>
                    </tr>



                    <tr>
                        <td colspan="9">[[[<asp:LinkButton ID="btnback" PostBackUrl="#" CssClass="btn btn-success" runat="server" Text="Back" />]]]
                        </td>


                        <td colspan="9">(((<asp:Button ID="BtnGenerate" CssClass="btn btn-success right" runat="server" Text="Generate Pdf" onclick="Button2_Click" />)))

                        </td>
                    </tr>
                </tbody>
            </table>


            <table class="table table-bordered table-striped" border="1" id="tblAccountStatementpdf" style="width: 100%; color: #383838 !important; font-size: 12px !important; font-family: Calibri, 'Nunito Sans', sans-serif !important; border: 1px solid #dee2e6 !important;">
                <thead >
                    <tr>
                        <th>Date</th>
                        <th>Invoice</th>
                        <%--    <th>Description</th>
                        <th>Job</th>--%>
                        <th>Due</th>
                        <%--<th>Currency</th>--%>
                        <th>Debit</th>
                        <th>Credit</th>
                        <th>Balance</th>

                    </tr>
                </thead>
                <tbody id="tblAccountStatementbody">
                    <tr>
                        <td colspan="3" style="text-align: right; font-size: 11px"><b>Opening </b></td>

                        <td>
                            <label id="lblBCurrency">AED</label>
                        </td>
                        <td>
                            <label id="lblBDebit">0.00</label>
                        </td>
                        <td></td>
                        <td></td>
                    </tr>
                </tbody>

               <%-- <tfoot>
                    <tr>
                        <td colspan="2" style="text-align: right; font-size: 11px"><b>Closing </b></td>

                        <td>
                            <label id="lblFCurrency">AED</label>
                        </td>
                        <td>
                            <label id="lblFDebit">1,23,000</label>
                        </td>
                        <td></td>
                        <td></td>
                    </tr>

                </tfoot>--%>
            </table>
            <br/>
            <h4>Age Analysis</h4>
            <table class="table table-bordered table-striped" border="1" id="tblAgingAndAnalysis" style="width: 100%; color: #383838 !important; font-size: 12px !important; font-family: Calibri, 'Nunito Sans', sans-serif !important; border: 1px solid #dee2e6 !important;">
                <thead>
                <tr>
                   < <th></th>

                    <th>Total</th>
                    <th>Current</th>
                    <th>1 month </th>
                    <th>2 months </th>
                    <th>3 months </th>
                    <th>+3 months</th>


                </tr>
                    </thead>
                <tbody id="Ageing"></tbody>
              <%--  <tr>
                    <td>Outstanding</td>
                    <td>
                        <label id="lbltotaloutstanding">12345</label></td>
                    <td>
                        <label id="lblcurrentoutstanding"></label>
                        2345</td>
                    <td>
                        <label id="lbl1monthoutstanding">34567</label>
                    </td>
                    <td>
                        <label id="lbl2monthoutstanding">4567</label>
                    </td>
                    <td>
                        <label id="lbl3monthoutstanding">567</label>
                    </td>
                    <td>
                        <label id="lbl3pmonthoutstanding">6789</label>
                    </td>
                </tr>
                <tr>
                    <td>On Account </td>
                    <td>
                        <label id="lbltotalonaccount">12345</label></td>
                    <td>
                        <label id="lblcurrentonaccount"></label>
                        2345</td>
                    <td>
                        <label id="lbl1monthonaccount">34567</label>
                    </td>
                    <td>
                        <label id="lbl2monthonaccount">4567</label>
                    </td>
                    <td>
                        <label id="lbl3monthonaccount">567</label>
                    </td>
                    <td>
                        <label id="lbl3pmonthonaccount">6789</label>
                    </td>
                </tr>
                <tr>
                    <td>PDC Covered</td>
                    <td>
                        <label id="lbltotalpdccovered">12345</label></td>
                    <td>
                        <label id="lblcurrentpdccovered"></label>
                        2345</td>
                    <td>
                        <label id="lbl1monthpdccovered">34567</label>
                    </td>
                    <td>
                        <label id="lbl2monthpdccovered">4567</label>
                    </td>
                    <td>
                        <label id="lbl3monthpdccovered">567</label>
                    </td>
                    <td>
                        <label id="lbl3pmonthpdccovered">6789</label>
                    </td>
                </tr>
                <tr>
                    <td>Balance </td>
                     <td>
                        <label id="lbltotalbalance">12345</label></td>
                    <td>
                        <label id="lblcurrentbalance"></label>
                        2345</td>
                    <td>
                        <label id="lbl1monthbalance">34567</label>
                    </td>
                    <td>
                        <label id="lbl2monthbalance">4567</label>
                    </td>
                    <td>
                        <label id="lbl3monthbalance">567</label>
                    </td>
                    <td>
                        <label id="lbl3pmonthbalance">6789</label>
                    </td>
                </tr>
                <tr>
                    <td>UnallocPDC </td>
                    <td>
                        <label id="lbltotalUnallocPDC">12345</label></td>
                    <td>
                        <label id="lblcurrentUnallocPDC"></label>
                        2345</td>
                    <td>
                        <label id="lbl1monthUnallocPDC">34567</label>
                    </td>
                    <td>
                        <label id="lbl2monthUnallocPDC">4567</label>
                    </td>
                    <td>
                        <label id="lbl3monthUnallocPDC">567</label>
                    </td>
                    <td>
                        <label id="lbl3pmonthUnallocPDC">6789</label>
                    </td>
                </tr>--%>
            </table>
            <table class="table table-bordered table-striped"  style="width: 100%; color: #383838 !important; font-size: 12px !important; font-family: Calibri, 'Nunito Sans', sans-serif !important; border: 1px solid #dee2e6 !important;">
                <tr>

                    <td colspan="8" style='padding: 10px 4px!important; border-right: 1px solid #dee2e6!important; border-bottom: 1px solid #dee2e6!important;'>
                        <b>Note:This is Computer Generated Statement, no Signature is Required</b>
                    </td>
                </tr>
            </table>
            <%--</div>

            </header>--%>
        </div>
    </form>

    <script src="<%=G.B%>assets/vendor_components/jquery-3.3.1/jquery-3.3.1.js"></script>
    <script src="<%=G.B%>assets/vendor_components/popper/dist/popper.min.js"></script>
    <script src="<%=G.B%>assets/vendor_components/bootstrap/dist/js/bootstrap.min.js"></script>

    <script src="../General/libo.js"></script>

    <script>
        $(document).ready(function () {
            if (window.location.search.includes('?')) {

                var urlParams = new URLSearchParams(window.location.search);
                CustomeId = urlParams.get('Cus_id');
               var btDate = urlParams.get('Date');
                GetMetaData(CustomeId, btDate)
              
               
                

            }
        });

        function GetMetaData(CustomerId, btDate) {
           
            $.ajax({
                url: 'H_tbl_Customer.ashx',
                type: "POST",
                data: {
                    'fun':'GetMatadataforPdf', 'CustomerId': CustomerId
                },
                success: function (data) {
                    if (Chk_Res(data.errorMessage) == false) {
                        var arr = data.split('|');

                        var CompaneyData = JSON.parse(arr[0]);
                        var CustomerData = "";
                        if (arr[1] != "") {
                            CustomerData = JSON.parse(arr[1]);
                        }


                        $.each(CompaneyData, function (i, obj) {

                            SetInnerVal("Tdcompny", " <b> " + obj.Company_Name + "</b>")
                            SetInnerVal("tdCompnyAddress", " <b> " + obj.Address + "</b>")
                            $('#lbldatetime').text(SetTodaysDateLabel());
                            $('#lblphone').text(obj.Phone_Number);
                            $('#lblfax').text("");
                            $('#lblTRNo').text(obj.VAT_Number);
                        });

                        $.each(CustomerData, function (i, obj) {

                            SetInnerVal("CusAddress", " <b> " + obj.Cus_Company_Name + " <br /> " + obj.Address + "    </b>");
                            $('#FileNameField').val("Stament Of Account of "+obj.Cus_Company_Name)
                        });
                        var arrdt = btDate.split("-");
                        $('#lblfromdate').text(arrdt[0].toString());
                        $('#lbltodate').text(arrdt[1].toString());
                        GetAccountData(CustomerId, btDate);
                        GetAgingAnalysisData(CustomerId, btDate);
                    }
                }
        });
        }
        function GetAccountData(CustomerId, btDate) {
            $('#tblAccountStatementbody').empty();
            $.ajax({
                url: 'H_tbl_Customer.ashx',
                type: "POST",
                data: {
                    'fun': 'GetAccountData', 'CustomerId': CustomerId, 'date': btDate
                },
                success: function (data) {
                    if (Chk_Res(data.errorMessage) == false) {
                        if (data.toString() != "") {
                            var AccountData = JSON.parse(data);

                            $.each(AccountData, function (i, obj) {
                                $('#tblAccountStatementbody').append($("<tr>  <td style='padding: 10px 4px!important; border-right: 1px solid #dee2e6!important; border-bottom: 1px solid #dee2e6!important;'>" + DateFormat(obj.Invoice_date) + "</td> "
                                    + "<td style='padding: 10px 4px!important; border-right: 1px solid #dee2e6!important; border-bottom: 1px solid #dee2e6!important;'> " + obj.Invoice_Number + "</td > "
                                    + "<td style='padding: 10px 4px!important; border-right: 1px solid #dee2e6!important; border-bottom: 1px solid #dee2e6!important;' >" + DateFormat(obj.Due_Date) + "</td>"
                                    + " <td style='padding: 10px 4px!important; border-right: 1px solid #dee2e6!important; border-bottom: 1px solid #dee2e6!important;'>" + obj.debit + "</td>"
                                    + " <td style='padding: 10px 4px!important; border-right: 1px solid #dee2e6!important; border-bottom: 1px solid #dee2e6!important;'>" + obj.credit + "</td> "
                                    +"<td style='padding: 10px 4px!important; border-right: 1px solid #dee2e6!important; border-bottom: 1px solid #dee2e6!important;'> " + obj.balance + "</td>    </tr > "))
                            });
                        } else {
                            $('#tblAccountStatementbody').append($("<tr>  <td colspan='6' style='padding: 10px 4px!important; border-right: 1px solid #dee2e6!important; border-bottom: 1px solid #dee2e6!important;'> No Records Found </td>   </tr>"))
                        }
                    }

                }
            });
        }

        function GetAgingAnalysisData(CustomerId, btDate) {
            $('#Ageing').empty();
            $.ajax({
                url: 'H_tbl_Customer.ashx',
                type: "POST",
                data: {
                    'fun': 'GetAgingAnalysisData', 'CustomerId': CustomerId, 'date': btDate
                },
                success: function (data) {
                    if (Chk_Res(data.errorMessage) == false) {
                        if (data.toString() != "") {
                            var AccountData = JSON.parse(data);

                            $.each(AccountData, function (i, obj) {
                                $('#Ageing').append($("<tr>  <td >" + obj.CLOSING_BALANCE + "</td> "
                                    + " <td style='padding: 10px 4px!important; border-right: 1px solid #dee2e6!important; border-bottom: 1px solid #dee2e6!important;'>" + obj.a + "</td> "
                                    + " <td style='padding: 10px 4px!important; border-right: 1px solid #dee2e6!important; border-bottom: 1px solid #dee2e6!important;'>" + obj.b + "</td> "
                                    + " <td style='padding: 10px 4px!important; border-right: 1px solid #dee2e6!important; border-bottom: 1px solid #dee2e6!important;'>" + obj.c + "</td> "
                                    + "<td style='padding: 10px 4px!important; border-right: 1px solid #dee2e6!important; border-bottom: 1px solid #dee2e6!important;'>" + obj.d + "</td> "
                                    + " <td style='padding: 10px 4px!important; border-right: 1px solid #dee2e6!important; border-bottom: 1px solid #dee2e6!important;'>" + obj.ABOVE120 + "</td>    </tr>"))
                            });
                        } else {
                            $('#Ageing').append($("<tr>  <td colspan='6'> No Records Found </td>   </tr>"))
                        }
                    }
                    var Html = $("#wrap_invoice").html()

                    $("#wrap_invoice").html($("#wrap_invoice").html().replace("[[[", "").replace("]]]", "").replace("(((", "").replace(")))", "").replace("@@@", "").replace("$$$", ""));

                    var part = Html.slice(Html.indexOf("[[["), Html.indexOf("]]]") + 3);

                    Html = Html.replace(part, "");

                    part = Html.slice(Html.indexOf("((("), Html.indexOf(")))") + 3);

                    Html = Html.replace(part, "");

                    var part = Html.slice(Html.indexOf("@@@"), Html.indexOf("$$$") + 3);

                    Html = Html.replace(part, "");
                    SetVal("HtmlContent", Html)
                }
            });
        }
        function SetTodaysDateLabel() {
            var date = new Date();
            Date.prototype.setDate = function () {
                var yyyy = this.getFullYear().toString();
                var mm = (this.getMonth() + 1).toString(); // getMonth() is zero-based
                var dd = this.getDate().toString();
                return (dd[1] ? dd : "0" + dd[0]) + "-" + (mm[1] ? mm : "0" + mm[0]) + "-" + yyyy ; // padding
                //return dd + "-" + mm + "-" + yyyy;
            };
            return date.setDate();
        }
        function DateFormat(datestring) {
            var date = new Date(datestring);
            var yyyy = date.getFullYear().toString();
            var mm = (date.getMonth() + 1).toString(); // getMonth() is zero-based
            var dd = date.getDate().toString();
            return (dd[1] ? dd : "0" + dd[0]) + "-" + (mm[1] ? mm : "0" + mm[0]) + "-" + yyyy; // padding
        }
    </script>  

</body>
</html>
